---
title : JPA 
---



# JPA

JAVA의 ORM 표준인 JPA를 사용한다.

ORM은 RDB와 도메인 주도 설계 사이를 해소해준다. 쿼리중심의 화면, 개발에서 벗어날 수 있다.

해당 문서는 도메인 모델 정의가 완료된 후, JPA로 구현하는 방법을 중심으로 설명한다. 

**각각 소주제에 대해서 더 자세한 점은 책, [에이펙스 기술블로그] (https://apexsoft.github.io/) 를 참고하거나, 구글링을 한다.**

### 기능 
1. 엔터티와 DB 테이블 매핑하는 설계 부분 (DDL 자동 생성)
2. 매핑한 엔터티를 사용하는 부분 (SQL 자동 생성)

### 영속성 컨텍스트 (Persistence context)
JPA에서는 영속성 컨텍스트가 존재한다. 

* 개념적으로 존재하여 눈에 보이지 않는다. 

* 영속성 컨텍스트에 엔터티가 저장되고, 저장된 엔터티를 엔터티 매니저가 생명주기에 따라 관리한다. 
    * 영속성 컨텍스트 내의 엔터티 변경이 감지되면 엔터티매니저가 SQL을 날린다. (엔터티를 불변 타입으로 만들어야 하는 중요한 이유)

* SQL이 자동 전송되기 때문에, 트랜잭션 범위 설정을 주의해야 한다. 
	* 스프링 컨테이너는 트랜잭션 범위와 영속성 컨텍스트의 생존 범위가 같다. 
	* `@Transactional` 선언 > 트랜잭션 시작

## Aggregate 
Entity와 Value 타입을 설계하기 위해서 Aggregate 개념은 필수이다. 

완벽한 이해를 위해서는 도메인 모델 개념과 도메인 주도 설계에 대한 이해가 필요하다. 

* 애그리거트는 관련 객체를 하나로 묶은 군집이다. 

* 애그리거트에서 엔터티는 **루트 엔터티 하나**이다. 그러나, 필요에 따라 루트 엔터티 외에 다른 엔터티가 나올 수도 있다. 
    * 이론상으로 루트 엔터티만 두도록 권장하기 때문에 다른 엔터티가 있다면, 진짜 엔터티인지 혹은 애그리거트가 잘못 구성되었는지 꼭 의심해야 한다.

* 애그리거트에 속한 객체는 유사하거나 **동일한 라이프 사이클**을 가진다. 

* 애그리거트 내의 엔티티 및 밸류 객체의 데이터 수정은 애그리거트 루트를 통해서만 수행한다.