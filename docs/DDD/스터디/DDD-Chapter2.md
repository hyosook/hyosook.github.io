# CHAPTER 2 아키텍처 개요
## TODAY 
네 개의 영역
계층 구조 아키텍처
DIP
## NEXT..
도메인 영역의 주요 구성요소
요청 처리 흐름
인프라스트럭처 개요
모듈 구성

# 네 개의 영역

## 표현영역 ( = UI 영역 )

#### [질문] 표현영역에서 도메인 모델을 사용한다 ?

저번시간에 밸류는 DTO이고, DTO는 밸류로 볼수있다고 들었습니다. 그럼 일반적으로  화면에 보여야하는 것을 DTO로 만들어서 사용하는 경우가 많은데, (특히, Mybatis 사용 환경)
이런 상황은 **표현영역에서 도메인 모델을 사용한다** 라고 보는게 맞나요?

## 응용영역
* 기능 요구사항을 구현한다. 
* Service 영역 
> 사용자의 요청을 전달받은 응용 영역은 시스템이 사용자에게 제공해야할 기능을 구현한다. 

* 도메인 모델에 핵심 로직을 구현하고, 그 부분을 이용해서 응용 영역 로직을 구현한다.
> 응용 영역은 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용한다.
> 응용서비스는 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임한다.
> 응용 영역은 도메인 모델을 이용해서 사용자에게 제공할 기능을 구현 

[예제] p.38 서비스 구현 

## 도메인 영역
> 도메인 영역은 도메인 모델을 구현한다. 
> 도메인 모델은 도메인의 핵심 로직을 구현한다. 

## 인프라스트럭처 영역
> RDBMS 연동 처리 등 구현 기술에 대한 것을 다룬다. 
* 나머지 영역은 구현 기술을 사용한 코드를 직접 만들지 않고, 인프라스트럭처 영역에서 제공하는 기능을 사용해서 구현한다. 
* 프로젝트에 어떤 구현기술을 연동하는 부분? 

# 계층 구조 아키텍처
### 표현 > 응용 > 도메인 > 인프라스트럭처 
> 구현의 편리함을 위해 계층구조를 유연하게 적용한다. 예를 들어, 응용 계층은 바로 아래 계층인 도메인 계층에 의존하지만 외부 시스템과의 연동을 위해 더 아래 계층인 인프라스트럭처 계층에 의존하기도 한다. 

가장 많이 사용하는 아키텍처 구조이다.

### 특징 > 상위에서 하위계층으로 의존한다. 
하위계층은 상위 계층에 의존하지 않는다. 즉, 
> 인프라스트럭처 계층이 도메인에 의존하거나 도메인이 응용 계층에 의존하지 않는다. 

> 짚고 넘어가야할 것이 있는데 바로 표현, 응용, 도메인 계층이 상세한 구현 기술을 다루는 인프라스트럭처 계층에 종속된다.

#### 문제점 - 예제 참고
1. 응용영역을 테스트하기 어렵다. 인프라스트럭처가 완벽하게 구현되어 있어야한다. 
	* 응용 영역인 서비스에 인프라스트럭처 계층의 구현 기술 특화 코드가 사용됨으로, 인프라스트럭처 계층이 완벽하게 구현될때까지 기다렸다가 테스트해야한다. 
2. 구현 방식을 변경이 어렵다. 인프라스트럭처에서 사용한 구현기술에 의존한다.
	* 구현 기술에 대한 특화된 코드가 서비스에 사용됨으로, 인프라스트럭처 계층에서 사용한 구현기술이 변경되면 응용 계층인 서비스 내의 소스도 변경해야한다.  

### DIP 를 적용하여 위 두가지 문제점을 해소한다. 

### DIP와 아키텍처 - p.52 그림 2.12
p.40의 그림 2.4와 차이 

#### [질문] 두 그림을 비교대상이라고 봐도 괜찮은지?

> 인프라스트럭처 영역은 구현기술을 다루는 저수준 모듈이고 응용 영역과 도메인 영역은 고수준 모듈이다. 

#### DIP (Dependency Inversion Principle, 의존 역전 원칙) 
* 고수준 모듈 : 의미 있는 단일 기능 제공 모듈 
	> 고수준 모듈의 기능을 구현하려면 여러 하위 기능이 필요하다. 
	* 책에서 고수준 모듈(의미 있는 단일 기능)은 **가격 할인 계산**

* 저수준 모듈 : 하위 기능을 구현한 것 
	> 고수준 모듈이 제대로 동작하려면 저수준 모듈을 사용해야 한다. 
	* 책에서는 구현기술을 사용하는 부분이 저수준 모듈에 들어갔다. (하위 기능)

고수준 모듈이 저수준 모듈에 의존하면, 위에서 언급했던 두 가지 문제가 발생한다. 
처음에 소개했던 아키텍처 구조가 고수준 모듈이 저수준 모듈에 의존하는 형태이다.

DIP 는 **저수준 모듈**이 **고수준 모듈**에 의존하도록 한다. 

##### 구현 방법 
추상화 인터페이스로 저수준 모듈을 구현한다. 고수준모듈이 추상화 인터페이스인 저수준 모듈을 이용한다. 
이렇게하면, 고수준모듈은 구현 기술에 의존하는 코드를 가지지 않는다. 

##### 두 가지 문제 해결에 대해
2번 문제는 저수준 모듈만 수정하는것으로 해결 가능하다. 
1번 문제는 인터페이스에 대용 객체를 대입해주어 사용 가능하다. 

##### [자문] 
p.44 2.7그림을 보면 `CalculateDiscountService`를 '고수준', 나머지를 '저수준'이라고 했으며, 
p.47 2.8그림은 DIP를 적용한 구조를 보면, `RuleDiscounter` 는 '고수준', `DroolsRuleDiscounter`는 '저수준'이라고 한다.
* 그럼 DIP를 적용하면서 더이상  `CalculateDiscountService`가 고수준이 아니라는건지? 

##### [자답] 
2.13그림 을 보면, 두 부분 모두 고수준이라고 했다. 

### DIP 주의사항
> 잘못 생각하면 단순히 인터페이스와 구현 클래스를 분리하는 정도로 받아들일 수 있다. 
> DIP 핵심은 고수준 모듈이 저수준 모듈에 의존하지 않도록 하기 위함인데 DIP를 적용한 결과 구조만 보고 인터페이스를 추출하는 경우가 있다. 

> DIP 적용할 때 하위 기능을 추상화한인터페이스는 고수준 모듈 관점에서 도출한다. 

